<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Survey-weighted generalised linear models.</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for svyglm {survey}"><tr><td>svyglm {survey}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Survey-weighted generalised linear models.</h2>

<h3>Description</h3>

<p>Fit a generalised linear model to data from a complex survey design,
with inverse-probability weighting and design-based standard errors.
</p>


<h3>Usage</h3>

<pre>
## S3 method for class 'survey.design'
svyglm(formula, design, subset=NULL,
family=stats::gaussian(),start=NULL, rescale=TRUE, ..., deff=FALSE,
 influence=FALSE)
## S3 method for class 'svyrep.design'
svyglm(formula, design, subset=NULL,
family=stats::gaussian(),start=NULL, rescale=NULL, ..., rho=NULL,
return.replicates=FALSE, na.action,multicore=getOption("survey.multicore"))
## S3 method for class 'svyglm'
summary(object, correlation = FALSE, df.resid=NULL,
...)
## S3 method for class 'svyglm'
predict(object,newdata=NULL,total=NULL,
                         type=c("link","response","terms"),
                         se.fit=(type != "terms"),vcov=FALSE,...)
## S3 method for class 'svrepglm'
predict(object,newdata=NULL,total=NULL,
                         type=c("link","response","terms"),
                         se.fit=(type != "terms"),vcov=FALSE,
                         return.replicates=!is.null(object$replicates),...)

</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>formula</code></td>
<td>
<p>Model formula</p>
</td></tr>
<tr valign="top"><td><code>design</code></td>
<td>
<p>Survey design from <code><a href="svydesign.html">svydesign</a></code> or <code><a href="svrepdesign.html">svrepdesign</a></code>. Must contain all variables
in the formula</p>
</td></tr>
<tr valign="top"><td><code>subset</code></td>
<td>
<p>Expression to select a subpopulation</p>
</td></tr>
<tr valign="top"><td><code>family</code></td>
<td>
<p><code>family</code> object for <code>glm</code></p>
</td></tr>
<tr valign="top"><td><code>start</code></td>
<td>
<p>Starting values for the coefficients (needed for some
uncommon link/family combinations)</p>
</td></tr>
<tr valign="top"><td><code>rescale</code></td>
<td>
<p>Rescaling of weights, to improve numerical stability. The default
rescales weights to sum to the sample size. Use <code>FALSE</code> to not
rescale weights. For replicate-weight designs, use <code>TRUE</code> to
rescale weights to sum to 1, as was the case before version 3.34.</p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p>Other arguments passed to <code>glm</code> or
<code>summary.glm</code> </p>
</td></tr>
<tr valign="top"><td><code>rho</code></td>
<td>
<p>For replicate BRR designs, to specify the parameter for
Fay's variance method, giving weights of <code>rho</code> and <code>2-rho</code></p>
</td></tr>
<tr valign="top"><td><code>return.replicates</code></td>
<td>
<p>Return the replicates as the <code>replicates</code> component of the
result? (for <code>predict</code>, only possible if they
were computed in the <code>svyglm</code> fit)</p>
</td></tr>
<tr valign="top"><td><code>deff</code></td>
<td>
<p>Estimate the design effects</p>
</td></tr>
<tr valign="top"><td><code>influence</code></td>
<td>
<p>Return influence functions</p>
</td></tr>
<tr valign="top"><td><code>object</code></td>
<td>
<p>A <code>svyglm</code> object</p>
</td></tr>
<tr valign="top"><td><code>correlation</code></td>
<td>
<p>Include the correlation matrix of parameters?</p>
</td></tr>
<tr valign="top"><td><code>na.action</code></td>
<td>
<p>Handling of NAs</p>
</td></tr>
<tr valign="top"><td><code>multicore</code></td>
<td>
<p>Use the <code>multicore</code> package to distribute
replicates across processors?</p>
</td></tr>	      
<tr valign="top"><td><code>df.resid</code></td>
<td>
<p>Optional denominator degrees of freedom for Wald
tests</p>
</td></tr>
<tr valign="top"><td><code>newdata</code></td>
<td>
<p>new data frame for prediction</p>
</td></tr>
<tr valign="top"><td><code>total</code></td>
<td>
<p>population size when predicting population total</p>
</td></tr>
<tr valign="top"><td><code>type</code></td>
<td>
<p>linear predictor (<code>link</code>) or response</p>
</td></tr>
<tr valign="top"><td><code>se.fit</code></td>
<td>
<p>if <code>TRUE</code>, return variances of predictions</p>
</td></tr>
<tr valign="top"><td><code>vcov</code></td>
<td>
<p>if <code>TRUE</code> and <code>se=TRUE</code> return full
variance-covariance matrix of predictions</p>
</td></tr>
</table>


<h3>Details</h3>

<p>For binomial and Poisson families use <code>family=quasibinomial()</code>
and <code>family=quasipoisson()</code> to avoid a warning about non-integer
numbers of successes.  The &lsquo;quasi&rsquo; versions of the family objects give
the same point estimates and standard errors and do not give the
warning.
</p>
<p>If <code>df.resid</code> is not specified the df for the null model is
computed by <code><a href="svychisq.html">degf</a></code> and the residual df computed by
subtraction.  This is recommended by Korn and Graubard and is correct
for PSU-level covariates but is potentially very conservative for
individual-level covariates. To get tests based on a Normal distribution
use <code>df.resid=Inf</code>, and to use number of PSUs-number of strata,
specify <code>df.resid=degf(design)</code>.
</p>
<p>Parallel processing with <code>multicore=TRUE</code> is helpful only for
fairly large data sets and on computers with sufficient memory. It may
be incompatible with GUIs, although the Mac Aqua GUI appears to be safe.
</p>
<p><code>predict</code> gives fitted values and sampling variability for specific new
values of covariates.  When <code>newdata</code> are the population mean it
gives the regression estimator of the mean, and when <code>newdata</code> are
the population totals and <code>total</code> is specified it gives the
regression estimator of the population total.  Regression estimators of
mean and total can also be obtained with <code><a href="calibrate.html">calibrate</a></code>.
</p>


<h3>Value</h3>

 <p><code>svyglm</code> returns an object of class <code>svyglm</code>.  The
<code>predict</code> method returns an object of class <code>svystat</code></p>


<h3>Note</h3>

<p><code>svyglm</code> always returns 'model-robust' standard errors; the
Horvitz-Thompson-type standard errors used everywhere in the survey
package are a generalisation of the model-robust 'sandwich' estimators.
In particular, a quasi-Poisson <code>svyglm</code> will return correct
standard errors for relative risk regression models. 
</p>


<h3>Note</h3>

<p>This function does not return the same standard error estimates for the
regression estimator of population mean and total as some textbooks, or
SAS.  However, it does give the same standard error estimator as
estimating the mean or total with calibrated weights.
</p>
<p>In particular, under simple random sampling with or without replacement
there is a simple rescaling of the mean squared residual to estimate the
mean squared error of the regression estimator.   The standard error
estimate produced by <code>predict.svyglm</code> has very similar
(asymptotically identical) expected
value to the textbook estimate, and has the advantage of being
applicable when the supplied <code>newdata</code> are not the population mean
of the predictors. The difference is small when the sample size is large, but can be
appreciable for small samples.
</p>
<p>You can obtain the other standard error estimator by calling
<code>predict.svyglm</code> with the covariates set to their estimated (rather
than true) population mean values.
</p>


<h3>Author(s)</h3>

<p>Thomas Lumley</p>


<h3>References</h3>

<p>Lumley T, Scott A (2017) &quot;Fitting Regression Models to Survey Data&quot;
Statistical Science 32: 265-278
</p>


<h3>See Also</h3>

 
<p><code><a href="../../stats/html/glm.html">glm</a></code>, which is used to do most of the work.
</p>
<p><code><a href="regTermTest.html">regTermTest</a></code>, for multiparameter tests
</p>
<p><code><a href="calibrate.html">calibrate</a></code>, for an alternative way to specify regression
estimators of population totals or means
</p>
<p><code><a href="svyttest.html">svyttest</a></code> for one-sample and two-sample t-tests.
</p>


<h3>Examples</h3>

<pre>

  data(api)


  dstrat&lt;-svydesign(id=~1,strata=~stype, weights=~pw, data=apistrat, fpc=~fpc)
  dclus2&lt;-svydesign(id=~dnum+snum, weights=~pw, data=apiclus2)
  rstrat&lt;-as.svrepdesign(dstrat)
  rclus2&lt;-as.svrepdesign(dclus2)

  summary(svyglm(api00~ell+meals+mobility, design=dstrat))
  summary(svyglm(api00~ell+meals+mobility, design=dclus2))
  summary(svyglm(api00~ell+meals+mobility, design=rstrat))
  summary(svyglm(api00~ell+meals+mobility, design=rclus2))

  ## use quasibinomial, quasipoisson to avoid warning messages
  summary(svyglm(sch.wide~ell+meals+mobility, design=dstrat,
        family=quasibinomial()))


  ## Compare regression and ratio estimation of totals
  api.ratio &lt;- svyratio(~api.stu,~enroll, design=dstrat)
  pop&lt;-data.frame(enroll=sum(apipop$enroll, na.rm=TRUE))
  npop &lt;- nrow(apipop)
  predict(api.ratio, pop$enroll)

  ## regression estimator is less efficient
  api.reg &lt;- svyglm(api.stu~enroll, design=dstrat)
  predict(api.reg, newdata=pop, total=npop)
  ## same as calibration estimator
  svytotal(~api.stu, calibrate(dstrat, ~enroll, pop=c(npop, pop$enroll)))

  ## svyglm can also reproduce the ratio estimator
  api.reg2 &lt;- svyglm(api.stu~enroll-1, design=dstrat,
                    family=quasi(link="identity",var="mu"))
  predict(api.reg2, newdata=pop, total=npop)

  ## higher efficiency by modelling variance better
  api.reg3 &lt;- svyglm(api.stu~enroll-1, design=dstrat,
                    family=quasi(link="identity",var="mu^3"))
  predict(api.reg3, newdata=pop, total=npop)
  ## true value
  sum(apipop$api.stu)

 </pre>

<hr /><div style="text-align: center;">[Package <em>survey</em> version 4.1-1 <a href="00Index.html">Index</a>]</div>
</body></html>
