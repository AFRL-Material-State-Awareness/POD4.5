<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Quantiles under complex sampling.</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for newsvyquantile {survey}"><tr><td>newsvyquantile {survey}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>
Quantiles under complex sampling.
</h2>

<h3>Description</h3>

<p>Estimates quantiles and confidence intervals for them. This function was
completely re-written for version 4.1 of the survey package, and has a
wider range of ways to define the quantile. See the vignette for a list of them. 
</p>


<h3>Usage</h3>

<pre>
svyquantile(x, design, quantiles, ...)
## S3 method for class 'survey.design'
svyquantile(x, design, quantiles, alpha = 0.05,
                      interval.type = c("mean", "beta","xlogit", "asin","score"),
                      na.rm = FALSE,  ci=TRUE, se = ci,
                      qrule=c("math","school","shahvaish","hf1","hf2","hf3",
		      "hf4","hf5","hf6","hf7","hf8","hf9"),
                      df = NULL, ...)
## S3 method for class 'svyrep.design'
svyquantile(x, design, quantiles, alpha = 0.05,
                      interval.type = c("mean", "beta","xlogit", "asin","quantile"),
                      na.rm = FALSE, ci = TRUE, se=ci,
                      qrule=c("math","school","shahvaish","hf1","hf2","hf3",
		      "hf4","hf5","hf6","hf7","hf8","hf9"),
                      df = NULL, return.replicates=FALSE,...)		      
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>x</code></td>
<td>

<p>A one-sided formula describing variables to be used
</p>
</td></tr>
<tr valign="top"><td><code>design</code></td>
<td>

<p>Design object
</p>
</td></tr>
<tr valign="top"><td><code>quantiles</code></td>
<td>

<p>Numeric vector specifying which quantiles are requested
</p>
</td></tr>
<tr valign="top"><td><code>alpha</code></td>
<td>
<p>Specified confidence interval coverage</p>
</td></tr>
<tr valign="top"><td><code>interval.type</code></td>
<td>
<p>See Details below</p>
</td></tr>
<tr valign="top"><td><code>na.rm</code></td>
<td>
<p>Remove missing values?</p>
</td></tr>
<tr valign="top"><td><code>ci,se</code></td>
<td>
<p>Return an estimated confidence interval and standard error?</p>
</td></tr>
<tr valign="top"><td><code>qrule</code></td>
<td>
<p>Rule for defining the quantiles: either a character string specifying one of the built-in rules, or a function</p>
</td></tr>
<tr valign="top"><td><code>df</code></td>
<td>
<p>Degrees of freedom for confidence interval estimation: <code>NULL</code> specifies <code>degf(design)</code></p>
</td></tr>
<tr valign="top"><td><code>return.replicates</code></td>
<td>
<p>Return replicate estimates of the quantile (only for <code>interval.type="quantile"</code>)</p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>

<p>For future expansion
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The <code>p</code>th quantile is defined as the value where the estimated cumulative
distribution function is equal to <code>p</code>. As with quantiles in
unweighted data, this definition only pins down the quantile to an
interval between two observations, and a rule is needed to interpolate.
The default is the mathematical definition, the lower end of the
quantile interval; <code>qrule="school"</code> uses the midpoint of the
quantile interval; <code>"hf1"</code> to &quot;hf9&quot; are weighted analogues of
<code>type=1</code> to <code>9</code> in <code><a href="../../stats/html/quantile.html">quantile</a></code>. See the vignette
&quot;Quantile rules&quot; for details and for how to write your own. 
</p>
<p>By default, confidence intervals are estimated using Woodruff's (1952) method,
which involves computing the quantile, estimating a confidence interval
for the proportion of observations below the quantile, and then
transforming that interval using the estimated CDF.  In that context,
the <code>interval.type</code> argument specifies how the confidence interval
for the proportion is computed, matching <code><a href="svyciprop.html">svyciprop</a></code>. In
contrast to <code>oldsvyquantile</code>, <code>NaN</code> is returned if a confidence
interval endpoint on the probability scale falls outside <code>[0,1]</code>.
</p>
<p>There are two exceptions. For <code>svydesign</code> objects,
<code>interval.type="score"</code> asks for the Francisco &amp; Fuller confidence
interval based on inverting a score test. According to Dorfmann &amp;
Valliant, this interval has inferior performance to the <code>"beta"</code>
and <code>"logit"</code> intervals; it is provided for compatibility.
</p>
<p>For replicate-weight designs, <code>interval.type="quantile"</code> ask for an
interval based directly on the replicates of the quantile. This interval
is not valid for jackknife-type replicates, though it should perform well for
bootstrap-type replicates, BRR, and SDR.
</p>
<p>The <code>df</code> argument specifies degrees of freedom for a t-distribution
approximation to distributions of means. The default is the design degrees of
freedom. Specify <code>df=Inf</code> to use a Normal distribution (eg, for compatibility).
</p>
<p>When the standard error is requested, it is estimated by dividing the
confidence interval length by the number of standard errors in a t
confidence interval with the specified <code>alpha</code>. For example, with
<code>alpha=0.05</code> and <code>df=Inf</code> the standard error is estimated as the confidence
interval length divided by <code>2*1.96</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>"newsvyquantile"</code>, except that with a
replicate-weights design and <code>interval.type="quantile"</code> and
<code>return.replicates=TRUE</code> it's an object of class <code>"svrepstat"</code>
</p>


<h3>References</h3>

<p>Dorfman A, Valliant R (1993) Quantile variance estimators in complex
surveys. Proceedings of the ASA Survey Research Methods Section. 1993: 866-871
</p>
<p>Francisco CA, Fuller WA (1986) Estimation of the distribution
function with a complex survey. Technical Report, Iowa State
University.
</p>
<p>Hyndman, R. J. and Fan, Y. (1996) Sample quantiles in statistical packages,
The American Statistician 50, 361-365.
</p>
<p>Shah BV, Vaish AK (2006) Confidence Intervals for Quantile Estimation
from Complex Survey Data. Proceedings of the Section on Survey
Research Methods. 
</p>
<p>Woodruff RS (1952) Confidence intervals for medians and other
position measures. JASA 57, 622-627.
</p>


<h3>See Also</h3>

<p><code>vignette("qrule", package = "survey")</code>
<code><a href="oldsvyquantile.html">oldsvyquantile</a></code>	 
<code><a href="../../stats/html/quantile.html">quantile</a></code>
</p>


<h3>Examples</h3>

<pre>
data(api)
## population
quantile(apipop$api00,c(.25,.5,.75))

## one-stage cluster sample
dclus1&lt;-svydesign(id=~dnum, weights=~pw, data=apiclus1, fpc=~fpc)
rclus1&lt;-as.svrepdesign(dclus1)
bclus1&lt;-as.svrepdesign(dclus1,type="boot")


svyquantile(~api00, dclus1, c(.25,.5,.75))
svyquantile(~api00, dclus1, c(.25,.5,.75),interval.type="beta")

svyquantile(~api00, rclus1, c(.25,.5,.75))
svyquantile(~api00, rclus1, c(.25,.5,.75),interval.type="quantile")
svyquantile(~api00, bclus1, c(.25,.5,.75),interval.type="quantile")

svyquantile(~api00+ell, dclus1, c(.25,.5,.75), qrule="math")
svyquantile(~api00+ell, dclus1, c(.25,.5,.75), qrule="school")
svyquantile(~api00+ell, dclus1, c(.25,.5,.75), qrule="hf8")

</pre>

<hr /><div style="text-align: center;">[Package <em>survey</em> version 4.1-1 <a href="00Index.html">Index</a>]</div>
</body></html>
