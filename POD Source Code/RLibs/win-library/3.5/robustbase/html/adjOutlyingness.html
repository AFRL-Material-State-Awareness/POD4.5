<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Compute (Skewness-adjusted) Multivariate Outlyingness</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for adjOutlyingness {robustbase}"><tr><td>adjOutlyingness {robustbase}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Compute (Skewness-adjusted) Multivariate Outlyingness</h2>

<h3>Description</h3>

<p>For an <i>n * p</i> data matrix (or data frame) <code>x</code>,
compute the &ldquo;<em>outlyingness</em>&rdquo; of all <i>n</i> observations.
Outlyingness here is a generalization of the Donoho-Stahel
outlyingness measure, where skewness is taken into account via the
medcouple, <code><a href="mc.html">mc</a>()</code>.
</p>


<h3>Usage</h3>

<pre>
adjOutlyingness(x, ndir = 250, p.samp = p, clower = 4, cupper = 3,
                IQRtype = 7,
                alpha.cutoff = 0.75, coef = 1.5,
                qr.tol = 1e-12, keep.tol = 1e-12,
                only.outlyingness = FALSE, maxit.mult = max(100, p),
                trace.lev = 0,
                mcReflect = n &lt;= 100, mcScale = TRUE, mcMaxit = 2*maxit.mult,
                mcEps1 = 1e-12, mcEps2 = 1e-15,
                mcTrace = max(0, trace.lev-1))
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>x</code></td>
<td>
<p>a numeric <i>n * p</i> <code><a href="../../base/html/matrix.html">matrix</a></code> or
<code><a href="../../base/html/data.frame.html">data.frame</a></code>,
which must be of full rank <i>p</i>.</p>
</td></tr>
<tr valign="top"><td><code>ndir</code></td>
<td>
<p>positive integer specifying the number of directions that
should be searched.</p>
</td></tr>
<tr valign="top"><td><code>p.samp</code></td>
<td>
<p>the sample size to use for finding good random
directions, must be at least <code>p</code>.  The default, <code>p</code> had
been hard coded previously.</p>
</td></tr>
<tr valign="top"><td><code>clower, cupper</code></td>
<td>
<p>the constant to be used for the lower and upper
tails, in order to transform the data towards symmetry.  You can set
<code>clower = 0, cupper = 0</code> to get the <em>non</em>-adjusted,
i.e., classical (&ldquo;central&rdquo; or &ldquo;symmetric&rdquo;)
outlyingness.  In that case, <code><a href="mc.html">mc</a>()</code> is not used.</p>
</td></tr>
<tr valign="top"><td><code>IQRtype</code></td>
<td>
<p>a number from <code>1:9</code>, denoting type of empirical
quantile computation for the <code><a href="../../stats/html/IQR.html">IQR</a>()</code>.  The default 7
corresponds to <code><a href="../../stats/html/quantile.html">quantile</a></code>'s and <code><a href="../../stats/html/IQR.html">IQR</a></code>'s
default.  MM has evidence that <code>type=6</code> would be a bit more stable
for small sample size.</p>
</td></tr>
<tr valign="top"><td><code>alpha.cutoff</code></td>
<td>
<p>number in (0,1) specifying the quantiles
<i>(&alpha;, 1-&alpha;)</i> which determine the &ldquo;outlier&rdquo;
cutoff.  The default, using quartiles, corresponds to the definition
of the medcouple (<code><a href="mc.html">mc</a></code>), but there is no stringent
reason for using the same alpha for the outlier cutoff.</p>
</td></tr>
<tr valign="top"><td><code>coef</code></td>
<td>
<p>positive number specifying the factor with which the
interquartile range (<code><a href="../../stats/html/IQR.html">IQR</a></code>) is multiplied to determine
&lsquo;boxplot hinges&rsquo;-like upper and lower bounds.</p>
</td></tr>
<tr valign="top"><td><code>qr.tol</code></td>
<td>
<p>positive tolerance to be used for <code><a href="../../Matrix/html/qr-methods.html">qr</a></code> and
<code><a href="../../base/html/qr.html">solve.qr</a></code> for determining the <code>ndir</code> directions,
each determined by a random sample of <i>p</i> (out of <i>n</i>)
observations.  Note that the default <i>10^{-12}</i> is rather small,
and <code><a href="../../Matrix/html/qr-methods.html">qr</a></code>'s default <code>= 1e-7</code> may be more appropriate.</p>
</td></tr>
<tr valign="top"><td><code>keep.tol</code></td>
<td>
<p>positive tolerance to determine which of the sample
direction should be kept, namely only those for which
<i>||x|| * ||B||</i> is larger than <code>keep.tol</code>.</p>
</td></tr>
<tr valign="top"><td><code>only.outlyingness</code></td>
<td>
<p>logical indicating if the final outlier
determination should be skipped.  In that case, a vector is
returned, see &lsquo;Value:&rsquo; below.</p>
</td></tr>
<tr valign="top"><td><code>maxit.mult</code></td>
<td>
<p>integer factor; <code>maxit &lt;- maxit.mult * ndir</code>
will determine the maximal number of direction searching
iterations.  May need to be increased for higher dimensional data,
though increasing <code>ndir</code> may be more important.</p>
</td></tr>
<tr valign="top"><td><code>trace.lev</code></td>
<td>
<p>an integer, if positive allows to monitor the
direction search.</p>
</td></tr>
</table>

<table summary="R argblock">
<tr valign="top"><td><code>mcReflect</code></td>
<td>
<p>passed as <code>doReflect</code> to <code><a href="mc.html">mc</a>()</code>.</p>
</td></tr>
<tr valign="top"><td><code>mcScale</code></td>
<td>
<p>passed as <code>doScale</code> to <code><a href="mc.html">mc</a>()</code>.</p>
</td></tr>
<tr valign="top"><td><code>mcMaxit</code></td>
<td>
<p>passed as <code>maxit</code> to <code><a href="mc.html">mc</a>()</code>.</p>
</td></tr>
<tr valign="top"><td><code>mcEps1</code></td>
<td>
<p>passed as <code>eps1</code> to <code><a href="mc.html">mc</a>()</code>; the default is slightly
looser (100 larger) than the default for <code>mc</code>().</p>
</td></tr>
<tr valign="top"><td><code>mcEps2</code></td>
<td>
<p>passed as <code>eps2</code> to <code><a href="mc.html">mc</a>()</code>.</p>
</td></tr>
<tr valign="top"><td><code>mcTrace</code></td>
<td>
<p>passed as <code>trace.lev</code> to <code><a href="mc.html">mc</a>()</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p><b>FIXME</b>:  Details in the comment of the Matlab code;
also in the reference(s).



</p>
<p>The method as described can be useful as preprocessing in
FASTICA (<a href="http://research.ics.aalto.fi/ica/fastica/">http://research.ics.aalto.fi/ica/fastica/</a>
see also the <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> package <a href="https://CRAN.R-project.org/package=fastICA"><span class="pkg">fastICA</span></a>.
</p>


<h3>Value</h3>

<p>If <code>only.outlyingness</code> is true, a vector <code>adjout</code>,
otherwise, as by default, a list with components
</p>
<table summary="R valueblock">
<tr valign="top"><td><code>adjout</code></td>
<td>
<p>numeric of <code>length(n)</code> giving the adjusted
outlyingness of each observation.</p>
</td></tr>
<tr valign="top"><td><code>cutoff</code></td>
<td>
<p>cutoff for &ldquo;outlier&rdquo; with respect to the adjusted
outlyingnesses, and depending on <code>alpha.cutoff</code>.</p>
</td></tr>
<tr valign="top"><td><code>nonOut</code></td>
<td>
<p>logical of <code>length(n)</code>, <code>TRUE</code> when the
corresponding observation is <b>non</b>-outlying with respect to the
cutoff and the adjusted outlyingnesses.</p>
</td></tr>
</table>


<h3>Note</h3>


<p>If there are too many degrees of freedom for the projections, i.e., when
<i>n &lt;= 4*p</i>, the current definition of adjusted outlyingness
is ill-posed, as one of the projections may lead to a denominator
(quartile difference) of zero, and hence formally an adjusted
outlyingness of infinity.
The current implementation avoids <code>Inf</code> results, but will return
seemingly random <code>adjout</code> values of around <i>10^{14} -- 10^{15}</i> which may
be completely misleading, see, e.g., the <code>longley</code> data example.
</p>
<p>The result is <em>random</em> as it depends on the sample of
<code>ndir</code> directions chosen; specifically, to get sub samples the algorithm uses
<code><a href="../../base/html/sample.html">sample.int</a>(n, p.samp)</code>
which from <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> version 3.6.0 depends on
<code><a href="../../base/html/Random.html">RNGkind</a>(*, sample.kind)</code>.  Exact reproducibility of results
from <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> versions 3.5.3 and earlier, requires setting
<code><a href="../../base/html/Random.html">RNGversion</a>("3.5.0")</code>.
In any case, do use <code><a href="../../base/html/Random.html">set.seed</a>()</code> yourself
for reproducibility!
</p>
<p>Till Aug/Oct. 2014, the default values for <code>clower</code> and <code>cupper</code> were
accidentally reversed, and the signs inside <code>exp(.)</code> where swapped
in the (now corrected) two expressions </p>
<pre>
 tup &lt;- Q3 + coef * IQR * exp(.... + clower * tmc * (tmc &lt; 0))
 tlo &lt;- Q1 - coef * IQR * exp(.... - cupper * tmc * (tmc &lt; 0))
</pre>
<p>already in the code from Antwerpen (&lsquo;<span class="file">mcrsoft/adjoutlingness.R</span>&rsquo;),
contrary to the published reference.
</p>
<p>Further, the original algorithm had not been scale-equivariant in the
direction construction, which has been amended in 2014-10 as well.
</p>
<p>The results, including diagnosed outliers, therefore have changed,
typically slightly, since <span class="pkg">robustbase</span> version 0.92-0.
</p>


<h3>Author(s)</h3>

<p>Guy Brys; help page and improvements by Martin Maechler</p>


<h3>References</h3>

<p>Brys, G., Hubert, M., and Rousseeuw, P.J. (2005)
A Robustification of Independent Component Analysis;
<em>Journal of Chemometrics</em>, <b>19</b>, 1&ndash;12.
</p>
<p>Hubert, M., Van der Veeken, S. (2008)
Outlier detection for skewed data;
<em>Journal of Chemometrics</em> <b>22</b>, 235&ndash;246;
doi: <a href="http://doi.org/10.1002/cem.1123">10.1002/cem.1123</a>.





</p>
<p>For the up-to-date reference, please consult

<a href="https://wis.kuleuven.be/statdatascience/robust">https://wis.kuleuven.be/statdatascience/robust</a>
</p>


<h3>See Also</h3>

<p>the adjusted boxplot, <code><a href="adjbox.html">adjbox</a></code> and the medcouple,
<code><a href="mc.html">mc</a></code>.
</p>


<h3>Examples</h3>

<pre>
## An Example with bad condition number and "border case" outliers

dim(longley) # 16 x 7  // set seed, as result is random :
set.seed(31)
ao1 &lt;- adjOutlyingness(longley, mcScale=FALSE)
## which are outlying ?
which(!ao1$nonOut) ## for this seed, two: "1956", "1957"; (often: none)
## For seeds 1:100, we observe (Linux 64b)
if(FALSE) {
  adjO &lt;- sapply(1:100, function(iSeed) {
            set.seed(iSeed); adjOutlyingness(longley)$nonOut })
  table(nrow(longley) - colSums(adjO))
}
## #{outl.}:  0  1  2  3
## #{cases}: 74 17  6  3


## An Example with outliers :

dim(hbk)
set.seed(1)
ao.hbk &lt;- adjOutlyingness(hbk)
str(ao.hbk)
hist(ao.hbk $adjout)## really two groups
table(ao.hbk$nonOut)## 14 outliers, 61 non-outliers:
## outliers are :
which(! ao.hbk$nonOut) # 1 .. 14   --- but not for all random seeds!

## here, they are the same as found by (much faster) MCD:
cc &lt;- covMcd(hbk)
stopifnot(all(cc$mcd.wt == ao.hbk$nonOut))

## This is revealing: About 1--2 cases, where outliers are *not* == 1:14
##  but needs almost 1 [sec] per call:
if(interactive()) {
  for(i in 1:30) {
    print(system.time(ao.hbk &lt;- adjOutlyingness(hbk)))
    if(!identical(iout &lt;- which(!ao.hbk$nonOut), 1:14)) {
	 cat("Outliers:\n"); print(iout)
    }
  }
}

## "Central" outlyingness: *not* calling mc()  anymore, since 2014-12-11:
trace(mc)
out &lt;- capture.output(
  oo &lt;- adjOutlyingness(hbk, clower=0, cupper=0)
)
untrace(mc)
stopifnot(length(out) == 0)

## A rank-deficient case
T &lt;- tcrossprod(data.matrix(toxicity))
try(adjOutlyingness(T, maxit. = 20, trace.lev = 2)) # fails and recommends:
T. &lt;- fullRank(T)
aT &lt;- adjOutlyingness(T.)
plot(sort(aT$adjout, decreasing=TRUE), log="y")
plot(T.[,9:10], col = (1:2)[1 + (aT$adjout &gt; 10000)])
## .. (not conclusive; directions are random, more 'ndir' makes a difference!)
</pre>

<hr /><div style="text-align: center;">[Package <em>robustbase</em> version 0.95-0 <a href="00Index.html">Index</a>]</div>
</body></html>
